# 🖼️ 图像处理MCP服务器 - 完整使用指南

## 📋 项目功能概览

这是一个功能完整的**图像处理MCP (Model Context Protocol) 服务器**，提供以下核心功能：

### ✅ 已完成的功能

#### 1. 🔍 智能图片分析 (`analyze_image`)
- **基础信息**：尺寸、格式、文件大小、颜色通道
- **OCR文字识别**：支持中英文混合识别，提供置信度和位置信息
- **颜色分析**：提取主色调和调色板
- **图片质量评估**：分析图片质量、复杂度、方向等

#### 2. 🗜️ 图片压缩优化 (`compress_image`)
- **多种压缩算法**：WebP、AVIF、MozJPEG
- **智能质量控制**：支持目标文件大小优化
- **尺寸限制**：可设置最大宽高限制
- **Web优化**：专门的Web图片优化功能

#### 3. 🔄 格式转换 (`convert_format`)
- **全格式支持**：JPG、PNG、WebP、AVIF、GIF、BMP、TIFF
- **智能格式选择**：根据图片特性自动选择最佳现代格式
- **响应式版本**：一键生成多尺寸响应式图片
- **质量控制**：精确的质量和压缩参数控制

#### 4. 🎨 颜色提取 (`extract_colors`)
- **多种算法**：Vibrant和ColorThief算法
- **完整调色板**：提取主色调、鲜艳色、柔和色等
- **色彩分析**：亮度、对比度、饱和度统计
- **色彩和谐**：分析配色方案和色温

#### 5. ⚡ 批量处理 (`batch_process`)
- **并发控制**：可配置并发数量，避免系统过载
- **进度跟踪**：实时处理进度反馈
- **错误处理**：详细的成功/失败统计
- **批量验证**：预先验证图片源的有效性

## 🚀 如何在本地使用这个MCP

### 方法1: 在Claude Desktop中使用（推荐）

#### 步骤1: 配置Claude Desktop

1. 打开Claude Desktop的配置文件：
   - Windows: `%APPDATA%\Claude\claude_desktop_config.json`
   - macOS: `~/Library/Application Support/Claude/claude_desktop_config.json`

2. 添加MCP服务器配置：
```json
{
  "mcpServers": {
    "image-processor": {
      "command": "node",
      "args": ["C:/Users/28188/Downloads/mcpServer-main/image-processor-mcp/dist/index.js"],
      "env": {
        "LOG_LEVEL": "INFO"
      }
    }
  }
}
```

#### 步骤2: 重启Claude Desktop

重启Claude Desktop后，你就可以在对话中直接使用图像处理功能了！

#### 步骤3: 使用示例

在Claude Desktop中，你可以这样使用：

```
请帮我分析这张图片：https://picsum.photos/800/600
```

```
请将这张图片压缩为WebP格式，质量设为80%
```

```
提取这张图片的主色调和调色板
```

### 方法2: 命令行测试

#### 快速测试
```bash
# 进入项目目录
cd C:\Users\28188\Downloads\mcpServer-main\image-processor-mcp

# 运行简单测试
node simple-test.js
```

#### 完整MCP客户端测试
```bash
# 运行完整的MCP协议测试
node test-client.js
```

### 方法3: 作为独立服务使用

#### 启动服务器
```bash
npm start
```

#### 通过其他MCP客户端连接
服务器启动后，可以通过任何支持MCP协议的客户端连接使用。

## 📝 详细使用示例

### 1. 图片分析示例

```json
{
  "name": "analyze_image",
  "arguments": {
    "source": "https://example.com/image.jpg",
    "options": {
      "includeOCR": true,
      "includeColors": true,
      "ocrLanguage": "chi_sim+eng",
      "outputFormat": "markdown"
    }
  }
}
```

**支持的图片来源：**
- 🌐 网络图片：`https://example.com/image.jpg`
- 📁 本地文件：`./images/photo.png`
- 📋 Base64数据：`data:image/jpeg;base64,/9j/4AAQ...`

### 2. 图片压缩示例

```json
{
  "name": "compress_image",
  "arguments": {
    "source": "https://example.com/large-image.jpg",
    "options": {
      "quality": 80,
      "algorithm": "webp",
      "maxWidth": 1200,
      "maxHeight": 800,
      "outputFormat": "base64"
    }
  }
}
```

### 3. 格式转换示例

```json
{
  "name": "convert_format",
  "arguments": {
    "source": "./input/image.png",
    "targetFormat": "webp",
    "options": {
      "quality": 90,
      "progressive": true
    }
  }
}
```

### 4. 颜色提取示例

```json
{
  "name": "extract_colors",
  "arguments": {
    "source": "https://example.com/colorful-image.jpg",
    "options": {
      "colorCount": 8,
      "algorithm": "vibrant",
      "outputFormat": "css"
    }
  }
}
```

### 5. 批量处理示例

```json
{
  "name": "batch_process",
  "arguments": {
    "sources": [
      "https://example.com/image1.jpg",
      "https://example.com/image2.png",
      "./local/image3.gif"
    ],
    "operation": "compress",
    "options": {
      "quality": 75,
      "algorithm": "webp"
    },
    "concurrency": 3
  }
}
```

## 🎯 实际应用场景

### 1. 网站图片优化
```
请将我网站的所有产品图片压缩为WebP格式，质量80%，最大宽度1200px
```

### 2. 品牌色彩提取
```
从我的品牌Logo中提取主色调，生成CSS变量
```

### 3. 文档OCR处理
```
识别这张扫描文档中的文字内容
```

### 4. 社交媒体图片处理
```
将这张图片调整为适合Instagram的尺寸并优化
```

## ⚙️ 配置选项

### 环境变量配置
创建 `.env` 文件：
```env
LOG_LEVEL=INFO
OUTPUT_DIR=./output
MAX_CONCURRENCY=5
REQUEST_TIMEOUT=30000
MAX_FILE_SIZE=10485760
DEFAULT_OCR_LANGUAGE=chi_sim+eng
```

### 高级配置
```json
{
  "processing": {
    "defaultQuality": 85,
    "maxImageSize": 10485760,
    "supportedFormats": ["jpg", "jpeg", "png", "webp", "avif", "gif", "bmp"]
  },
  "ocr": {
    "defaultLanguage": "chi_sim+eng",
    "timeout": 30000
  },
  "compression": {
    "defaultAlgorithm": "webp",
    "qualityRange": [10, 100]
  }
}
```

## 🔧 故障排除

### 常见问题

1. **Sharp安装失败**
```bash
npm rebuild sharp
```

2. **内存不足**
```bash
node --max-old-space-size=4096 dist/index.js
```

3. **权限问题**
```bash
sudo chown -R $USER:$USER ./output
```

### 调试模式
```bash
DEBUG=* npm start
# 或
LOG_LEVEL=DEBUG npm start
```

## 📊 测试结果示例

根据最新测试结果：

✅ **图片分析功能** - 完全正常
- 成功分析300x200图片
- 提取主色调: #b5aa95
- 识别方向: landscape

✅ **图片压缩功能** - 完全正常  
- 原始大小: 43 KB → 压缩后: 10 KB
- 压缩率: 75%
- 格式: WebP

✅ **颜色提取功能** - 完全正常
- 成功提取5种主色调
- 色彩方案: monochromatic
- 色温: cool

## 🎉 总结

这个图像处理MCP服务器已经**完全开发完成**并可以投入使用！它提供了：

- ✅ 5大核心功能模块
- ✅ 完整的MCP协议支持
- ✅ 多种输出格式（JSON、Markdown、HTML、CSS）
- ✅ 灵活的配置选项
- ✅ 详细的错误处理和日志
- ✅ 完整的测试套件

你现在就可以在Claude Desktop中配置并使用这个强大的图像处理服务！